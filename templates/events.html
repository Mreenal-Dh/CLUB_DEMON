{% extends 'base.html' %}
{% block title %}Events{% endblock %}

{% block content %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const bgLayer = document.querySelector('.bg-layer');
        if (bgLayer) {
            bgLayer.classList.add('club-detail-bg');
        }
        
        // Search functionality
        const searchInput = document.getElementById('eventSearch');
        const eventBricks = document.querySelectorAll('.event-brick');
        const noResults = document.getElementById('noResults');
        
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase().trim();
            let visibleCount = 0;
            
            eventBricks.forEach(brick => {
                const title = brick.querySelector('h3').textContent.toLowerCase();
                const category = brick.querySelector('.event-category').textContent.toLowerCase();
                const eventId = parseInt(brick.getAttribute('data-event'));
                const event = eventData[eventId];
                const description = event ? event.description.toLowerCase() : '';
                const organizer = event ? event.organizer.toLowerCase() : '';
                
                const matches = title.includes(searchTerm) || 
                               category.includes(searchTerm) ||
                               description.includes(searchTerm) ||
                               organizer.includes(searchTerm);
                
                if (matches) {
                    brick.style.display = '';
                    visibleCount++;
                } else {
                    brick.style.display = 'none';
                }
            });
            
            // Show/hide no results message
            if (visibleCount === 0 && searchTerm !== '') {
                noResults.style.display = 'flex';
            } else {
                noResults.style.display = 'none';
            }
        });
    });
</script>

<section class="events-page">
    <div class="events-header">
        <h1>Campus Events</h1>
        <p class="events-subtitle">Discover upcoming workshops, competitions, and cultural activities</p>
        
        <!-- Animated Search Bar -->
        <div class="search-container">
            <div class="search-wrapper">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input 
                    type="text" 
                    id="eventSearch" 
                    class="search-input" 
                    placeholder="Search events by title, category, organizer..."
                    autocomplete="off">
                <div class="search-underline"></div>
            </div>
        </div>
    </div>

    <!-- No Results Message -->
    <div id="noResults" class="no-results-message" style="display: none;">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
        </svg>
        <h3>No events found</h3>
        <p>Try adjusting your search terms</p>
    </div>

    <!-- Pinterest-Style Masonry Grid - Dynamically Generated -->
    <div class="events-masonry-grid">
        {% for event in events %}
        <div class="event-brick {{ event.size_class }}" data-event="{{ event.id }}">
            <div class="event-image-wrapper">
                <img src="{{ event.image_url }}" alt="{{ event.title }}" class="event-image">
                <div class="event-overlay">
                    <span class="event-date">{{ event.date }}</span>
                </div>
            </div>
            <div class="event-brick-info">
                <h3>{{ event.title }}</h3>
                <span class="event-category">{{ event.category }}</span>
            </div>
        </div>
        {% endfor %}
        
        {% if events|length == 0 %}
        <div class="no-events-message">
            <h2>No Events Yet</h2>
            <p>Check back later for upcoming events!</p>
        </div>
        {% endif %}
    </div>
</section>

<!-- Event Detail Modal -->
<div id="eventModal" class="event-modal" aria-hidden="true">
    <div class="event-modal-content">
        <button class="modal-close" aria-label="Close modal">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
        
        <div class="modal-layout">
            <div class="modal-image-container">
                <img id="modalImage" src="" alt="Event Image" class="modal-image">
            </div>
            
            <div class="modal-details">
                <div class="modal-header">
                    <h2 id="modalTitle">Event Title</h2>
                    <span id="modalCategory" class="modal-category">Category</span>
                </div>
                
                <div class="modal-meta">
                    <div class="meta-item">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        <span id="modalDate">Date</span>
                    </div>
                    <div class="meta-item">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        <span id="modalTime">Time</span>
                    </div>
                    <div class="meta-item">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        <span id="modalLocation">Location</span>
                    </div>
                </div>
                
                <div class="modal-description">
                    <h3>About the Event</h3>
                    <p id="modalDescription">Event description will appear here...</p>
                </div>
                
                <div class="modal-organizer">
                    <h3>Organized By</h3>
                    <div class="organizer-info">
                        <div class="organizer-avatar">
                            <span id="organizerInitials">CB</span>
                        </div>
                        <div class="organizer-text">
                            <h4 id="modalOrganizer">Club Name</h4>
                            <p>Student Organization</p>
                        </div>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button class="btn-register">
                        Register Now
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                            <polyline points="12 5 19 12 12 19"></polyline>
                        </svg>
                    </button>
                    <button class="btn-share">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="18" cy="5" r="3"></circle>
                            <circle cx="6" cy="12" r="3"></circle>
                            <circle cx="18" cy="19" r="3"></circle>
                            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                        </svg>
                        Share
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Build event data from server-side data
const eventData = {
    {% for event in events %}
    {{ event.id }}: {
        title: {{ event.title|tojson }},
        category: {{ event.category|tojson }},
        date: {{ event.date|tojson }},
        time: {{ event.time|tojson }},
        location: {{ event.location|tojson }},
        description: {{ event.description|tojson }},
        organizer: {{ event.organizer|tojson }},
        image: {{ event.image_url|tojson }}
    }{% if not loop.last %},{% endif %}
    {% endfor %}
};

// Modal functionality
const modal = document.getElementById('eventModal');
const modalClose = document.querySelector('.modal-close');
const eventBricks = document.querySelectorAll('.event-brick');

eventBricks.forEach(brick => {
    brick.addEventListener('click', function() {
        const eventId = parseInt(this.getAttribute('data-event'));
        const event = eventData[eventId];
        
        if (!event) return;
        
        // Populate modal
        document.getElementById('modalImage').src = event.image;
        document.getElementById('modalTitle').textContent = event.title;
        document.getElementById('modalCategory').textContent = event.category;
        document.getElementById('modalDate').textContent = event.date;
        document.getElementById('modalTime').textContent = event.time;
        document.getElementById('modalLocation').textContent = event.location;
        document.getElementById('modalDescription').textContent = event.description;
        document.getElementById('modalOrganizer').textContent = event.organizer;
        
        // Set organizer initials
        const initials = event.organizer.split(' ').map(word => word[0]).join('').substring(0, 2).toUpperCase();
        document.getElementById('organizerInitials').textContent = initials;
        
        // Show modal
        modal.classList.add('active');
        modal.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';
    });
});

// Close modal
function closeModal() {
    modal.classList.remove('active');
    modal.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
}

modalClose.addEventListener('click', closeModal);
modal.addEventListener('click', function(e) {
    if (e.target === modal) closeModal();
});
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && modal.classList.contains('active')) closeModal();
});

// Register and Share buttons
document.querySelector('.btn-register').addEventListener('click', function() {
    alert('Registration feature coming soon! Please contact the organizing club.');
});

document.querySelector('.btn-share').addEventListener('click', function() {
    const title = document.getElementById('modalTitle').textContent;
    if (navigator.share) {
        navigator.share({
            title: title,
            text: 'Check out this event at IIIT Naya Raipur!',
            url: window.location.href
        }).catch(err => console.log('Error sharing:', err));
    } else {
        // Fallback: copy to clipboard
        const url = window.location.href;
        navigator.clipboard.writeText(url).then(() => {
            alert('Link copied to clipboard!');
        });
    }
});
</script>

<style>
/* Search Bar Styles */
.search-container {
    margin-top: 32px;
    display: flex;
    justify-content: center;
}

.search-wrapper {
    position: relative;
    width: 100%;
    max-width: 600px;
}

.search-icon {
    position: absolute;
    left: 20px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--muted);
    pointer-events: none;
    transition: all 0.3s ease;
}

.search-input {
    width: 100%;
    padding: 16px 20px 16px 56px;
    background: rgba(255,255,255,0.05);
    border: 2px solid rgba(255,255,255,0.1);
    border-radius: 50px;
    color: var(--text-100);
    font-size: 16px;
    font-weight: 500;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    outline: none;
}

.search-input::placeholder {
    color: var(--muted);
}

.search-input:focus {
    background: rgba(255,255,255,0.08);
    border-color: rgba(70,130,255,0.5);
    box-shadow: 0 0 0 4px rgba(70,130,255,0.1), 0 8px 24px rgba(70,130,255,0.2);
    transform: translateY(-2px);
}

.search-input:focus + .search-underline {
    transform: scaleX(1);
}

.search-wrapper:has(.search-input:focus) .search-icon {
    color: rgba(70,130,255,0.9);
    transform: translateY(-50%) scale(1.1);
}

.search-underline {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, rgba(70,130,255,0.8), rgba(90,150,255,0.6));
    transform: scaleX(0);
    transition: transform 0.3s ease;
    border-radius: 2px;
}

/* No Results Message */
.no-results-message {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 20px;
    text-align: center;
    animation: fadeIn 0.3s ease;
}

.no-results-message svg {
    color: var(--muted);
    opacity: 0.5;
    margin-bottom: 20px;
}

.no-results-message h3 {
    margin: 0 0 8px 0;
    font-size: 24px;
    color: var(--text-100);
    font-weight: 700;
}

.no-results-message p {
    margin: 0;
    font-size: 16px;
    color: var(--muted);
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Search input animation on page load */
@keyframes searchPulse {
    0%, 100% {
        box-shadow: 0 0 0 0 rgba(70,130,255,0.4);
    }
    50% {
        box-shadow: 0 0 0 8px rgba(70,130,255,0);
    }
}

.search-input {
    animation: searchPulse 2s ease-in-out 1s 1;
}

@media (max-width: 768px) {
    .search-container {
        margin-top: 24px;
    }
    
    .search-input {
        font-size: 14px;
        padding: 14px 18px 14px 52px;
    }
    
    .search-icon {
        left: 18px;
    }
}
</style>
{% endblock %}
